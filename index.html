<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>BarrelTracker</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<style>
:root{
  --bg:#070a12;
  --panel:#0b1227;
  --row:#0f172a;
  --rowAlt:#0c1324;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --hi:#22c55e;
  --mod:#f59e0b;
  --low:#64748b;
  --bad:#ef4444;
  --accent:#2563eb;
  --border:#1f2937;
  --radius:16px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  background:linear-gradient(180deg,#050812,#020617);
  color:var(--text);
}
header{
  padding:16px 20px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
h1{margin:0;font-size:20px}
button{
  background:#020617;
  color:var(--text);
  border:1px solid var(--border);
  border-radius:10px;
  padding:8px 12px;
  cursor:pointer;
}
button.primary{
  background:var(--accent);
  border-color:var(--accent);
}
.wrap{
  max-width:1400px;
  margin:0 auto;
  padding:16px;
}
.layout{
  display:grid;
  grid-template-columns:1.3fr .9fr;
  gap:16px;
}
.panel{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  overflow:hidden;
}
.panelHead{
  padding:12px 14px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.tableWrap{overflow:auto}
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
thead th{
  text-align:left;
  padding:10px;
  color:#c7d2fe;
  border-bottom:1px solid var(--border);
  white-space:nowrap;
}
tbody tr{background:var(--row);cursor:pointer}
tbody tr:nth-child(even){background:var(--rowAlt)}
tbody tr:hover{background:#14203d}
td{
  padding:10px;
  border-bottom:1px solid var(--border);
  white-space:nowrap;
}
.glow-high{box-shadow:inset 0 0 0 1px rgba(34,197,94,.35)}
.glow-mod{box-shadow:inset 0 0 0 1px rgba(245,158,11,.35)}
.glow-low{box-shadow:inset 0 0 0 1px rgba(100,116,139,.35)}
.drawer{
  padding:14px;
}
.session{
  padding:10px;
  border:1px solid var(--border);
  border-radius:12px;
  margin-bottom:10px;
  background:#020617;
}
.small{font-size:12px;color:var(--muted)}
.chip{
  display:inline-block;
  padding:4px 8px;
  border-radius:999px;
  border:1px solid var(--border);
  font-size:11px;
  margin-right:6px;
}
.spark{
  width:70px;height:16px;
}
.spark path{fill:none;stroke:currentColor;stroke-width:2}
</style>
</head>

<body>
<header>
  <h1>BarrelTracker</h1>
  <div>
    <button onclick="addBarrel()">+ Barrel</button>
  </div>
</header>

<div class="wrap">
  <div class="layout">

    <!-- RANKING STRIP -->
    <div class="panel">
      <div class="panelHead">
        <strong>Barrel Ranking — Current Form</strong>
        <select id="formWindow">
          <option value="200">200 rds</option>
          <option value="400" selected>400 rds</option>
          <option value="800">800 rds</option>
        </select>
      </div>
      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Barrel</th>
              <th>Score</th>
              <th>Conf</th>
              <th>Vert</th>
              <th>MR</th>
              <th>SD</th>
              <th>Life</th>
              <th>Trend</th>
              <th>Last</th>
            </tr>
          </thead>
          <tbody id="rankBody"></tbody>
        </table>
      </div>
    </div>

    <!-- DRAWER -->
    <div class="panel">
      <div class="panelHead">
        <strong id="drawerTitle">Select a barrel</strong>
        <div>
          <button id="importBtn" class="primary" onclick="showImport()" disabled>Import</button>
          <button onclick="showManual()" disabled id="manualBtn">+ Manual</button>
        </div>
      </div>
      <div class="drawer" id="drawerBody">
        <div class="small">No barrel selected.</div>
      </div>
    </div>

  </div>
</div>

<script>
let barrels=[];
let sessions=[];
let selected=null;

function addBarrel(){
  const id='B'+(barrels.length+1);
  barrels.push({id});
  selected=id;
  render();
}

function showImport(){
  const d=document.getElementById('drawerBody');
  d.innerHTML=`
    <div class="small">Import ShotMarker + Chrono (logic wired next)</div>
    <p class="small">This is the import-first anchor. No sample data.</p>
  `;
}

function showManual(){
  const d=document.getElementById('drawerBody');
  d.innerHTML=`
    <div class="small">Manual session (fallback)</div>
    <button onclick="addFakeSession()">Add test session</button>
  `;
}

function addFakeSession(){
  sessions.push({
    barrel:selected,
    vert:(0.55+Math.random()*0.3),
    mr:(0.2+Math.random()*0.15),
    sd:(6+Math.random()*3),
    conf:'high',
    date:new Date().toISOString().slice(0,10)
  });
  render();
}

function render(){
  const body=document.getElementById('rankBody');
  body.innerHTML='';
  barrels.forEach((b,i)=>{
    const s=sessions.filter(x=>x.barrel===b.id);
    const avg=k=>s.length?(s.reduce((a,x)=>a+x[k],0)/s.length):null;
    const tr=document.createElement('tr');
    tr.className=s.length?'glow-high':'';
    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${b.id}</td>
      <td>${s.length?(100-(avg('vert')*60)).toFixed(1):'—'}</td>
      <td>${s.length?'High':'—'}</td>
      <td>${s.length?avg('vert').toFixed(2):'—'}</td>
      <td>${s.length?avg('mr').toFixed(2):'—'}</td>
      <td>${s.length?avg('sd').toFixed(1):'—'}</td>
      <td>${s.length*22}</td>
      <td>${s.length?'▲':''}</td>
      <td>${s.length?s[s.length-1].date:'—'}</td>
    `;
    tr.onclick=()=>{
      selected=b.id;
      document.getElementById('drawerTitle').textContent=b.id+' — Timeline';
      document.getElementById('importBtn').disabled=false;
      document.getElementById('manualBtn').disabled=false;
      showTimeline();
    };
    body.appendChild(tr);
  });
}

function showTimeline(){
  const d=document.getElementById('drawerBody');
  const s=sessions.filter(x=>x.barrel===selected);
  d.innerHTML=s.length?s.map(x=>`
    <div class="session">
      <span class="chip">Vert ${x.vert.toFixed(2)}</span>
      <span class="chip">MR ${x.mr.toFixed(2)}</span>
      <span class="chip">SD ${x.sd.toFixed(1)}</span>
      <span class="chip">High</span>
    </div>
  `).join(''):'<div class="small">No sessions yet.</div>';
}

render();
</script>
</body>
</html>
